// Skill Types
export const SKILL_TYPE = {
  ACTIVE: 'active',
  PASSIVE: 'passive',
};

// Target Types for active skills
export const TARGET_TYPE = {
  SINGLE_ENEMY: 'single_enemy',
  ALL_ENEMIES: 'all_enemies',
  SELF: 'self',
  SINGLE_ALLY: 'single_ally',
  ALL_ALLIES: 'all_allies',
  LOWEST_HP_ALLY: 'lowest_hp_ally',
  DEAD_ALLY: 'dead_ally',
};

// Effect Types
export const EFFECT_TYPE = {
  DAMAGE: 'damage',
  HEAL: 'heal',
  BUFF: 'buff',
  DEBUFF: 'debuff',
  SHIELD: 'shield',
  DOT: 'dot',
  HOT: 'hot',
};

// Skill Trees for each class
// New structure: tier-based prerequisites instead of lane pathing
// Tier 0: No prereqs (4 skills, 1 starter)
// Tier 1: Requires 2 Tier 0 skills (5 skills)
// Tier 2: Requires 3 Tier 1 skills (5 skills)
// Tier 3: Requires 4 Tier 2 skills (3 capstones - pick one path)
export const SKILL_TREES = {
  warrior: {
    id: 'warrior',
    name: 'Warrior',
    emoji: '‚öîÔ∏è',
    skills: [
      // Tier 0 - Core
      {
        id: 'warrior_power_strike',
        name: 'Power Strike',
        emoji: 'üí•',
        description: 'A powerful blow dealing 150% damage.',
        type: SKILL_TYPE.ACTIVE,
        tier: 0,
        starterSkill: true,
        cooldown: 3,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 1.5 },
      },
      {
        id: 'warrior_fortitude',
        name: 'Fortitude',
        emoji: 'üí™',
        description: 'Increases maximum HP by 30.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'stat_bonus', stats: { maxHp: 30 } },
      },
      {
        id: 'warrior_thick_skin',
        name: 'Thick Skin',
        emoji: 'üõ°Ô∏è',
        description: 'Increases defense by 5.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'stat_bonus', stats: { defense: 5 } },
      },
      {
        id: 'warrior_threatening_presence',
        name: 'Threatening Presence',
        emoji: 'üò†',
        description: 'Enemies prefer targeting you.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'threat_bonus', percent: 50 },
      },

      // Tier 1 - Requires 2 Tier 0
      {
        id: 'warrior_taunt',
        name: 'Taunt',
        emoji: 'üò§',
        description: 'Force all enemies to attack you for 2 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 5,
        targetType: TARGET_TYPE.SELF,
        effect: { type: EFFECT_TYPE.BUFF, taunt: 2 },
      },
      {
        id: 'warrior_shield_bash',
        name: 'Shield Bash',
        emoji: 'üî®',
        description: 'Deal 80% damage and stun enemy for 1 turn.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 5,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 0.8, stun: 1 },
      },
      {
        id: 'warrior_cleave',
        name: 'Cleave',
        emoji: '‚öîÔ∏è',
        description: 'Strike all enemies for 100% damage.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 4,
        targetType: TARGET_TYPE.ALL_ENEMIES,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 1.0 },
      },
      {
        id: 'warrior_iron_will',
        name: 'Iron Will',
        emoji: 'üèõÔ∏è',
        description: 'Reduce all damage taken by 15%.',
        type: SKILL_TYPE.PASSIVE,
        tier: 1,
        passive: { type: 'damage_reduction', percent: 15 },
      },
      {
        id: 'warrior_second_wind',
        name: 'Second Wind',
        emoji: 'üí®',
        description: 'Heal 10% HP when dropping below 30%.',
        type: SKILL_TYPE.PASSIVE,
        tier: 1,
        passive: { type: 'low_hp_heal', threshold: 0.3, healPercent: 0.1 },
      },

      // Tier 2 - Requires 3 Tier 1
      {
        id: 'warrior_shield_wall',
        name: 'Shield Wall',
        emoji: 'üß±',
        description: 'All allies take 25% less damage for 2 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 7,
        targetType: TARGET_TYPE.ALL_ALLIES,
        effect: { type: EFFECT_TYPE.BUFF, damageReduction: 0.25, duration: 2 },
      },
      {
        id: 'warrior_revenge',
        name: 'Revenge',
        emoji: 'üî•',
        description: 'Deal 25% damage back when hit.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'reflect_damage', percent: 25 },
      },
      {
        id: 'warrior_rallying_cry',
        name: 'Rallying Cry',
        emoji: 'üìØ',
        description: 'All allies deal 20% more damage for 3 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 6,
        targetType: TARGET_TYPE.ALL_ALLIES,
        effect: { type: EFFECT_TYPE.BUFF, damageBonus: 0.2, duration: 3 },
      },
      {
        id: 'warrior_unstoppable',
        name: 'Unstoppable',
        emoji: 'ü¶è',
        description: 'Immune to stun and slow effects.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'cc_immunity', stun: true, slow: true },
      },
      {
        id: 'warrior_bloodthirst',
        name: 'Bloodthirst',
        emoji: 'ü©∏',
        description: 'Heal for 15% of damage you deal.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'lifesteal', percent: 15 },
      },

      // Tier 3 - Capstones (Requires 4 Tier 2)
      {
        id: 'warrior_unbreakable',
        name: 'Unbreakable',
        emoji: 'üíé',
        description: 'Survive fatal hit and become immune for 3 turns. Once per room.',
        type: SKILL_TYPE.PASSIVE,
        tier: 3,
        passive: { type: 'cheat_death', immuneDuration: 3 },
      },
      {
        id: 'warrior_warlord',
        name: 'Warlord',
        emoji: 'üëë',
        description: 'While taunting, all allies deal 25% more damage.',
        type: SKILL_TYPE.PASSIVE,
        tier: 3,
        passive: { type: 'taunt_party_bonus', damageBonus: 0.25 },
      },
      {
        id: 'warrior_juggernaut',
        name: 'Juggernaut',
        emoji: 'üöÇ',
        description: 'Heal 3% max HP per enemy hit each turn.',
        type: SKILL_TYPE.PASSIVE,
        tier: 3,
        passive: { type: 'on_hit_heal_percent', percent: 3 },
      },
    ],
  },

  paladin: {
    id: 'paladin',
    name: 'Paladin',
    emoji: 'üõ°Ô∏è',
    skills: [
      // Tier 0 - Core
      {
        id: 'paladin_divine_shield',
        name: 'Divine Shield',
        emoji: '‚ú®',
        description: 'Reduce all damage taken by 50% for 2 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 0,
        starterSkill: true,
        cooldown: 5,
        targetType: TARGET_TYPE.SELF,
        effect: { type: EFFECT_TYPE.BUFF, damageReduction: 0.5, duration: 2 },
      },
      {
        id: 'paladin_holy_strength',
        name: 'Holy Strength',
        emoji: 'üí™',
        description: 'Increases maximum HP by 25.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'stat_bonus', stats: { maxHp: 25 } },
      },
      {
        id: 'paladin_blessed_armor',
        name: 'Blessed Armor',
        emoji: '‚öîÔ∏è',
        description: 'Increases defense by 6.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'stat_bonus', stats: { defense: 6 } },
      },
      {
        id: 'paladin_aura_of_light',
        name: 'Aura of Light',
        emoji: '‚òÄÔ∏è',
        description: 'All allies gain +2 defense.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'party_stat_bonus', stats: { defense: 2 } },
      },

      // Tier 1
      {
        id: 'paladin_consecration',
        name: 'Consecration',
        emoji: 'üåü',
        description: 'Deal 80% damage to all enemies.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 4,
        targetType: TARGET_TYPE.ALL_ENEMIES,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 0.8 },
      },
      {
        id: 'paladin_lay_on_hands',
        name: 'Lay on Hands',
        emoji: 'üôè',
        description: 'Heal lowest HP ally for 40% of their max HP.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 6,
        targetType: TARGET_TYPE.LOWEST_HP_ALLY,
        effect: { type: EFFECT_TYPE.HEAL, percentOfMax: 0.4 },
      },
      {
        id: 'paladin_judgment',
        name: 'Judgment',
        emoji: '‚ö°',
        description: 'Deal 200% holy damage to a single target.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 5,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 2.0 },
      },
      {
        id: 'paladin_righteous_defense',
        name: 'Righteous Defense',
        emoji: 'üõ°Ô∏è',
        description: 'When ally hit, 30% chance to taunt attacker.',
        type: SKILL_TYPE.PASSIVE,
        tier: 1,
        passive: { type: 'reactive_taunt', chance: 30 },
      },
      {
        id: 'paladin_holy_fervor',
        name: 'Holy Fervor',
        emoji: 'üî•',
        description: '+10% attack and +10% healing done.',
        type: SKILL_TYPE.PASSIVE,
        tier: 1,
        passive: { type: 'dual_bonus', attackBonus: 0.1, healingBonus: 0.1 },
      },

      // Tier 2
      {
        id: 'paladin_aura_of_protection',
        name: 'Aura of Protection',
        emoji: 'üîÆ',
        description: 'All allies take 20% less damage for 3 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 7,
        targetType: TARGET_TYPE.ALL_ALLIES,
        effect: { type: EFFECT_TYPE.BUFF, damageReduction: 0.2, duration: 3 },
      },
      {
        id: 'paladin_hammer_of_justice',
        name: 'Hammer of Justice',
        emoji: 'üî®',
        description: 'Deal 150% damage and stun for 2 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 6,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 1.5, stun: 2 },
      },
      {
        id: 'paladin_redemption',
        name: 'Redemption',
        emoji: 'üíñ',
        description: 'Heal 5% max HP when you kill an enemy.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'on_kill_heal_percent', percent: 5 },
      },
      {
        id: 'paladin_blessed_ground',
        name: 'Blessed Ground',
        emoji: 'üåø',
        description: 'All allies heal 3% HP per turn.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'party_regen', percent: 3 },
      },
      {
        id: 'paladin_zealotry',
        name: 'Zealotry',
        emoji: '‚öîÔ∏è',
        description: '+30% damage when above 80% HP.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'high_hp_bonus', threshold: 0.8, damageBonus: 0.3 },
      },

      // Tier 3 - Capstones
      {
        id: 'paladin_divine_intervention',
        name: 'Divine Intervention',
        emoji: 'üëº',
        description: 'When ally would die, heal them 50% instead. Once per room.',
        type: SKILL_TYPE.PASSIVE,
        tier: 3,
        passive: { type: 'save_ally', healPercent: 0.5 },
      },
      {
        id: 'paladin_avenger',
        name: 'Avenger',
        emoji: 'üî•',
        description: 'When ally drops below 30%, you deal +50% damage for 3 turns.',
        type: SKILL_TYPE.PASSIVE,
        tier: 3,
        passive: { type: 'avenger_rage', threshold: 0.3, damageBonus: 0.5, duration: 3 },
      },
      {
        id: 'paladin_beacon_of_light',
        name: 'Beacon of Light',
        emoji: 'üí°',
        description: '50% of healing you do also heals lowest ally.',
        type: SKILL_TYPE.PASSIVE,
        tier: 3,
        passive: { type: 'beacon_heal', percent: 50 },
      },
    ],
  },

  knight: {
    id: 'knight',
    name: 'Knight',
    emoji: 'üè∞',
    skills: [
      // Tier 0 - Core
      {
        id: 'knight_shield_bash',
        name: 'Shield Bash',
        emoji: 'üî®',
        description: 'Deal 100% damage and stun for 1 turn.',
        type: SKILL_TYPE.ACTIVE,
        tier: 0,
        starterSkill: true,
        cooldown: 4,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 1.0, stun: 1 },
      },
      {
        id: 'knight_heavy_armor',
        name: 'Heavy Armor',
        emoji: 'üõ°Ô∏è',
        description: 'Increases defense by 8.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'stat_bonus', stats: { defense: 8 } },
      },
      {
        id: 'knight_constitution',
        name: 'Constitution',
        emoji: '‚ù§Ô∏è',
        description: 'Increases maximum HP by 35.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'stat_bonus', stats: { maxHp: 35 } },
      },
      {
        id: 'knight_stalwart',
        name: 'Stalwart',
        emoji: 'üèõÔ∏è',
        description: 'Reduce all damage taken by 10%.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'damage_reduction', percent: 10 },
      },

      // Tier 1
      {
        id: 'knight_wall_of_steel',
        name: 'Wall of Steel',
        emoji: 'üß±',
        description: 'Reduce damage taken by 40% for 3 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 6,
        targetType: TARGET_TYPE.SELF,
        effect: { type: EFFECT_TYPE.BUFF, damageReduction: 0.4, duration: 3 },
      },
      {
        id: 'knight_aggro',
        name: 'Aggro',
        emoji: 'üò§',
        description: 'Taunt all enemies for 3 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 5,
        targetType: TARGET_TYPE.SELF,
        effect: { type: EFFECT_TYPE.BUFF, taunt: 3 },
      },
      {
        id: 'knight_counter',
        name: 'Counter',
        emoji: '‚Ü©Ô∏è',
        description: '25% chance to attack back when hit.',
        type: SKILL_TYPE.PASSIVE,
        tier: 1,
        passive: { type: 'counter_attack', chance: 25 },
      },
      {
        id: 'knight_fortified',
        name: 'Fortified',
        emoji: 'üè∞',
        description: '+5 defense and +15 max HP.',
        type: SKILL_TYPE.PASSIVE,
        tier: 1,
        passive: { type: 'stat_bonus', stats: { defense: 5, maxHp: 15 } },
      },
      {
        id: 'knight_stand_firm',
        name: 'Stand Firm',
        emoji: 'ü¶∂',
        description: 'Immune to knockback and displacement.',
        type: SKILL_TYPE.PASSIVE,
        tier: 1,
        passive: { type: 'displacement_immunity' },
      },

      // Tier 2
      {
        id: 'knight_shield_wall',
        name: 'Shield Wall',
        emoji: 'üõ°Ô∏è',
        description: 'All allies take 25% less damage for 2 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 7,
        targetType: TARGET_TYPE.ALL_ALLIES,
        effect: { type: EFFECT_TYPE.BUFF, damageReduction: 0.25, duration: 2 },
      },
      {
        id: 'knight_punish',
        name: 'Punish',
        emoji: '‚öîÔ∏è',
        description: 'Deal 150% damage. Double if you are taunting.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 4,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 1.5, bonusIfTaunting: 2.0 },
      },
      {
        id: 'knight_armor_master',
        name: 'Armor Master',
        emoji: 'üîß',
        description: 'Defense also reduces DoT damage.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'armor_vs_dot' },
      },
      {
        id: 'knight_bulwark',
        name: 'Bulwark',
        emoji: 'üß±',
        description: '-20% damage taken while above 50% HP.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'high_hp_reduction', threshold: 0.5, reduction: 20 },
      },
      {
        id: 'knight_retaliation',
        name: 'Retaliation',
        emoji: 'üí•',
        description: 'When hit, attacker takes 20 damage.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'reflect_flat', amount: 20 },
      },

      // Tier 3 - Capstones
      {
        id: 'knight_unbreakable',
        name: 'Unbreakable',
        emoji: 'üíé',
        description: 'Cannot drop below 1 HP for 3 turns. Once per room.',
        type: SKILL_TYPE.PASSIVE,
        tier: 3,
        passive: { type: 'cheat_death', duration: 3 },
      },
      {
        id: 'knight_fortress',
        name: 'Fortress',
        emoji: 'üèØ',
        description: 'All damage to allies redirected to you at -50%.',
        type: SKILL_TYPE.PASSIVE,
        tier: 3,
        passive: { type: 'redirect_damage', reduction: 50 },
      },
      {
        id: 'knight_colossus',
        name: 'Colossus',
        emoji: 'üóø',
        description: 'Reflect 50% of damage taken back to attackers.',
        type: SKILL_TYPE.PASSIVE,
        tier: 3,
        passive: { type: 'reflect_damage', percent: 50 },
      },
    ],
  },

  cleric: {
    id: 'cleric',
    name: 'Cleric',
    emoji: '‚ú®',
    skills: [
      // Tier 0 - Core
      {
        id: 'cleric_heal',
        name: 'Heal',
        emoji: 'üíö',
        description: 'Restore 30% HP to all allies.',
        type: SKILL_TYPE.ACTIVE,
        tier: 0,
        starterSkill: true,
        cooldown: 4,
        targetType: TARGET_TYPE.ALL_ALLIES,
        effect: { type: EFFECT_TYPE.HEAL, percentage: 0.3 },
      },
      {
        id: 'cleric_blessed',
        name: 'Blessed',
        emoji: 'üôè',
        description: 'Increases maximum HP by 20.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'stat_bonus', stats: { maxHp: 20 } },
      },
      {
        id: 'cleric_holy_aura',
        name: 'Holy Aura',
        emoji: '‚ú®',
        description: 'All allies gain +3 defense.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'party_stat_bonus', stats: { defense: 3 } },
      },
      {
        id: 'cleric_inner_light',
        name: 'Inner Light',
        emoji: 'üí°',
        description: '+15% healing done.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'healing_bonus', percent: 15 },
      },

      // Tier 1
      {
        id: 'cleric_smite',
        name: 'Smite',
        emoji: '‚ö°',
        description: 'Deal 180% holy damage to an enemy.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 4,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 1.8 },
      },
      {
        id: 'cleric_revitalize',
        name: 'Revitalize',
        emoji: 'üíñ',
        description: 'Heal over time: 15% HP to all allies over 3 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 6,
        targetType: TARGET_TYPE.ALL_ALLIES,
        effect: { type: EFFECT_TYPE.HOT, percentage: 0.15, duration: 3 },
      },
      {
        id: 'cleric_divine_shield',
        name: 'Divine Shield',
        emoji: 'üõ°Ô∏è',
        description: 'Block the next hit on lowest HP ally.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 5,
        targetType: TARGET_TYPE.LOWEST_HP_ALLY,
        effect: { type: EFFECT_TYPE.SHIELD, blockNextHit: true },
      },
      {
        id: 'cleric_purify',
        name: 'Purify',
        emoji: 'üåü',
        description: 'Remove all debuffs from all allies.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 6,
        targetType: TARGET_TYPE.ALL_ALLIES,
        effect: { type: EFFECT_TYPE.BUFF, cleanse: true },
      },
      {
        id: 'cleric_meditation',
        name: 'Meditation',
        emoji: 'üßò',
        description: '-1 cooldown on all skills.',
        type: SKILL_TYPE.PASSIVE,
        tier: 1,
        passive: { type: 'cooldown_reduction', amount: 1 },
      },

      // Tier 2
      {
        id: 'cleric_holy_nova',
        name: 'Holy Nova',
        emoji: 'üí´',
        description: 'Heal all allies 20% and damage all enemies 100%.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 6,
        targetType: TARGET_TYPE.ALL_ALLIES,
        effect: { type: EFFECT_TYPE.HEAL, percentage: 0.2, alsoDamage: true, damageMultiplier: 1.0 },
      },
      {
        id: 'cleric_sanctuary',
        name: 'Sanctuary',
        emoji: 'üèõÔ∏è',
        description: 'All allies take 20% less damage for 3 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 8,
        targetType: TARGET_TYPE.ALL_ALLIES,
        effect: { type: EFFECT_TYPE.BUFF, damageReduction: 0.2, duration: 3 },
      },
      {
        id: 'cleric_guardian_angel',
        name: 'Guardian Angel',
        emoji: 'üëº',
        description: 'Auto-heal lowest ally 10% when they drop below 40%.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'reactive_heal', threshold: 0.4, healPercent: 0.1 },
      },
      {
        id: 'cleric_martyr',
        name: 'Martyr',
        emoji: '‚ù§Ô∏è‚Äçüî•',
        description: 'Take 30% of damage dealt to allies.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'martyr', percent: 0.3 },
      },
      {
        id: 'cleric_retribution',
        name: 'Retribution',
        emoji: 'üî•',
        description: '+50% damage when ally dies (stacks).',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'vengeance', damageBonus: 0.5 },
      },

      // Tier 3 - Capstones
      {
        id: 'cleric_resurrection',
        name: 'Resurrection',
        emoji: '‚úùÔ∏è',
        description: 'Revive a fallen ally with 50% HP. Once per dungeon.',
        type: SKILL_TYPE.ACTIVE,
        tier: 3,
        cooldown: 999,
        targetType: TARGET_TYPE.DEAD_ALLY,
        effect: { type: EFFECT_TYPE.HEAL, revive: true, percentage: 0.5 },
      },
      {
        id: 'cleric_crusader',
        name: 'Crusader',
        emoji: '‚öîÔ∏è',
        description: 'Your attacks heal lowest ally for 50% of damage.',
        type: SKILL_TYPE.PASSIVE,
        tier: 3,
        passive: { type: 'damage_heals', percent: 50 },
      },
      {
        id: 'cleric_radiance',
        name: 'Radiance',
        emoji: 'üåû',
        description: 'All heals also grant a shield equal to 30% of heal.',
        type: SKILL_TYPE.PASSIVE,
        tier: 3,
        passive: { type: 'heal_shield', percent: 30 },
      },
    ],
  },

  druid: {
    id: 'druid',
    name: 'Druid',
    emoji: 'üåø',
    skills: [
      // Tier 0 - Core
      {
        id: 'druid_rejuvenation',
        name: 'Rejuvenation',
        emoji: 'üíö',
        description: 'Heal lowest HP ally for 40% of their max HP.',
        type: SKILL_TYPE.ACTIVE,
        tier: 0,
        starterSkill: true,
        cooldown: 4,
        targetType: TARGET_TYPE.LOWEST_HP_ALLY,
        effect: { type: EFFECT_TYPE.HEAL, percentOfMax: 0.4 },
      },
      {
        id: 'druid_natural_healing',
        name: 'Natural Healing',
        emoji: 'üçÉ',
        description: '+20% healing done.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'healing_bonus', percent: 20 },
      },
      {
        id: 'druid_thorns',
        name: 'Thorns',
        emoji: 'üåµ',
        description: 'Attackers take 10 damage when hitting you.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'reflect_flat', amount: 10 },
      },
      {
        id: 'druid_natures_gift',
        name: "Nature's Gift",
        emoji: 'üéÅ',
        description: '+15 max HP.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'stat_bonus', stats: { maxHp: 15 } },
      },

      // Tier 1
      {
        id: 'druid_wild_growth',
        name: 'Wild Growth',
        emoji: 'üå≥',
        description: 'Heal all allies for 15% HP.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 6,
        targetType: TARGET_TYPE.ALL_ALLIES,
        effect: { type: EFFECT_TYPE.HEAL, percentOfMax: 0.15 },
      },
      {
        id: 'druid_regrowth',
        name: 'Regrowth',
        emoji: 'üå±',
        description: 'HoT: 25% HP over 3 turns to one ally.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 5,
        targetType: TARGET_TYPE.LOWEST_HP_ALLY,
        effect: { type: EFFECT_TYPE.HOT, percentage: 0.25, duration: 3 },
      },
      {
        id: 'druid_wrath',
        name: 'Wrath',
        emoji: '‚òÄÔ∏è',
        description: 'Deal 150% nature damage.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 3,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 1.5 },
      },
      {
        id: 'druid_barkskin',
        name: 'Barkskin',
        emoji: 'ü™µ',
        description: 'Target ally takes 30% less damage for 3 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 5,
        targetType: TARGET_TYPE.LOWEST_HP_ALLY,
        effect: { type: EFFECT_TYPE.BUFF, damageReduction: 0.3, duration: 3 },
      },
      {
        id: 'druid_living_seed',
        name: 'Living Seed',
        emoji: 'üå∞',
        description: 'Heals plant a seed that heals 15% if target is hit.',
        type: SKILL_TYPE.PASSIVE,
        tier: 1,
        passive: { type: 'living_seed', healPercent: 0.15 },
      },

      // Tier 2
      {
        id: 'druid_tranquility',
        name: 'Tranquility',
        emoji: 'üåä',
        description: 'HoT: All allies 10% HP per turn for 4 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 8,
        targetType: TARGET_TYPE.ALL_ALLIES,
        effect: { type: EFFECT_TYPE.HOT, percentage: 0.1, duration: 4 },
      },
      {
        id: 'druid_moonfire',
        name: 'Moonfire',
        emoji: 'üåô',
        description: '120% damage to all + DoT 20% over 2 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 5,
        targetType: TARGET_TYPE.ALL_ENEMIES,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 1.2, dot: { percent: 0.2, duration: 2 } },
      },
      {
        id: 'druid_natures_swiftness',
        name: "Nature's Swiftness",
        emoji: 'üí®',
        description: '+3 speed.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'stat_bonus', stats: { speed: 3 } },
      },
      {
        id: 'druid_lifebloom',
        name: 'Lifebloom',
        emoji: 'üå∏',
        description: 'Your HoTs heal +25% on final tick.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'hot_bloom', bonusPercent: 25 },
      },
      {
        id: 'druid_overgrowth',
        name: 'Overgrowth',
        emoji: 'üå≤',
        description: 'HoTs can stack twice.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'hot_stacking', maxStacks: 2 },
      },

      // Tier 3 - Capstones
      {
        id: 'druid_tree_of_life',
        name: 'Tree of Life',
        emoji: 'üå≥',
        description: 'All healing +50% for 4 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 3,
        cooldown: 10,
        targetType: TARGET_TYPE.SELF,
        effect: { type: EFFECT_TYPE.BUFF, healingBonus: 0.5, duration: 4 },
      },
      {
        id: 'druid_rebirth',
        name: 'Rebirth',
        emoji: 'ü¶ã',
        description: 'Auto-revive first ally to die at 30%. Once per dungeon.',
        type: SKILL_TYPE.PASSIVE,
        tier: 3,
        passive: { type: 'auto_revive', healPercent: 0.3 },
      },
      {
        id: 'druid_natures_wrath',
        name: "Nature's Wrath",
        emoji: '‚ö°',
        description: 'Your damage heals lowest ally for 75% of damage.',
        type: SKILL_TYPE.PASSIVE,
        tier: 3,
        passive: { type: 'damage_heals', percent: 75 },
      },
    ],
  },

  shaman: {
    id: 'shaman',
    name: 'Shaman',
    emoji: 'üîÆ',
    skills: [
      // Tier 0 - Core
      {
        id: 'shaman_spirit_link',
        name: 'Spirit Link',
        emoji: 'üîó',
        description: 'Heal all 15% + buff attack 20% for 2 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 0,
        starterSkill: true,
        cooldown: 5,
        targetType: TARGET_TYPE.ALL_ALLIES,
        effect: { type: EFFECT_TYPE.HEAL, percentOfMax: 0.15, attackBuff: 0.2, duration: 2 },
      },
      {
        id: 'shaman_ancestral_power',
        name: 'Ancestral Power',
        emoji: 'üëª',
        description: '+5 attack.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'stat_bonus', stats: { attack: 5 } },
      },
      {
        id: 'shaman_elemental_focus',
        name: 'Elemental Focus',
        emoji: 'üåÄ',
        description: '+3 speed.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'stat_bonus', stats: { speed: 3 } },
      },
      {
        id: 'shaman_totemic_might',
        name: 'Totemic Might',
        emoji: 'ü™∂',
        description: '+10 max HP, +2 defense.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'stat_bonus', stats: { maxHp: 10, defense: 2 } },
      },

      // Tier 1
      {
        id: 'shaman_lightning_bolt',
        name: 'Lightning Bolt',
        emoji: '‚ö°',
        description: 'Deal 180% damage.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 3,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 1.8 },
      },
      {
        id: 'shaman_healing_stream',
        name: 'Healing Stream',
        emoji: 'üíß',
        description: 'HoT: All allies 6% HP per turn for 4 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 7,
        targetType: TARGET_TYPE.ALL_ALLIES,
        effect: { type: EFFECT_TYPE.HOT, percentage: 0.06, duration: 4 },
      },
      {
        id: 'shaman_purge',
        name: 'Purge',
        emoji: 'üßπ',
        description: 'Remove all buffs from target enemy.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 4,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DEBUFF, dispel: true },
      },
      {
        id: 'shaman_wind_fury',
        name: 'Wind Fury',
        emoji: 'üå™Ô∏è',
        description: '20% chance to attack twice.',
        type: SKILL_TYPE.PASSIVE,
        tier: 1,
        passive: { type: 'double_attack_chance', percent: 20 },
      },
      {
        id: 'shaman_ancestral_guidance',
        name: 'Ancestral Guidance',
        emoji: 'üß≠',
        description: '20% of damage you deal heals lowest ally.',
        type: SKILL_TYPE.PASSIVE,
        tier: 1,
        passive: { type: 'damage_heals', percent: 20 },
      },

      // Tier 2
      {
        id: 'shaman_chain_lightning',
        name: 'Chain Lightning',
        emoji: '‚ö°',
        description: '120% damage to all enemies.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 5,
        targetType: TARGET_TYPE.ALL_ENEMIES,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 1.2 },
      },
      {
        id: 'shaman_mana_tide',
        name: 'Mana Tide',
        emoji: 'üåä',
        description: 'All allies +3 speed for 3 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 6,
        targetType: TARGET_TYPE.ALL_ALLIES,
        effect: { type: EFFECT_TYPE.BUFF, speedBonus: 3, duration: 3 },
      },
      {
        id: 'shaman_earth_shield',
        name: 'Earth Shield',
        emoji: 'ü™®',
        description: 'Target absorbs next 80 damage.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 5,
        targetType: TARGET_TYPE.LOWEST_HP_ALLY,
        effect: { type: EFFECT_TYPE.SHIELD, amount: 80 },
      },
      {
        id: 'shaman_elemental_mastery',
        name: 'Elemental Mastery',
        emoji: 'üåü',
        description: '+15% damage and healing.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'dual_bonus', damageBonus: 0.15, healingBonus: 0.15 },
      },
      {
        id: 'shaman_spirit_walk',
        name: 'Spirit Walk',
        emoji: 'üë£',
        description: 'First turn of combat: +50% speed.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'first_turn_speed', percent: 50 },
      },

      // Tier 3 - Capstones
      {
        id: 'shaman_bloodlust',
        name: 'Bloodlust',
        emoji: 'ü©∏',
        description: 'All allies +50% attack, +5 speed for 3 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 3,
        cooldown: 12,
        targetType: TARGET_TYPE.ALL_ALLIES,
        effect: { type: EFFECT_TYPE.BUFF, attackBonus: 0.5, speedBonus: 5, duration: 3 },
      },
      {
        id: 'shaman_ascendance',
        name: 'Ascendance',
        emoji: 'üî•',
        description: 'Transform: +100% damage, attacks hit all enemies for 4 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 3,
        cooldown: 10,
        targetType: TARGET_TYPE.SELF,
        effect: { type: EFFECT_TYPE.BUFF, damageBonus: 1.0, aoeAttacks: true, duration: 4 },
      },
      {
        id: 'shaman_spirit_link_totem',
        name: 'Spirit Link Totem',
        emoji: 'üîó',
        description: 'All allies share damage equally, reduced by 20%.',
        type: SKILL_TYPE.PASSIVE,
        tier: 3,
        passive: { type: 'damage_sharing', reduction: 20 },
      },
    ],
  },

  mage: {
    id: 'mage',
    name: 'Mage',
    emoji: 'üßô',
    skills: [
      // Tier 0 - Core
      {
        id: 'mage_fireball',
        name: 'Fireball',
        emoji: 'üî•',
        description: 'Deal 200% damage to all enemies.',
        type: SKILL_TYPE.ACTIVE,
        tier: 0,
        starterSkill: true,
        cooldown: 5,
        targetType: TARGET_TYPE.ALL_ENEMIES,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 2.0 },
      },
      {
        id: 'mage_arcane_mind',
        name: 'Arcane Mind',
        emoji: 'üß†',
        description: '+15 attack.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'stat_bonus', stats: { attack: 15 } },
      },
      {
        id: 'mage_mana_efficiency',
        name: 'Mana Efficiency',
        emoji: 'üíé',
        description: '-1 cooldown on all skills.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'cooldown_reduction', amount: 1 },
      },
      {
        id: 'mage_glass_cannon',
        name: 'Glass Cannon',
        emoji: 'üí•',
        description: '+25% damage, -15 max HP.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'stat_bonus', stats: { maxHp: -15 }, damageBonus: 0.25 },
      },

      // Tier 1
      {
        id: 'mage_frost_nova',
        name: 'Frost Nova',
        emoji: '‚ùÑÔ∏è',
        description: '80% damage + slow all enemies 2 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 6,
        targetType: TARGET_TYPE.ALL_ENEMIES,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 0.8, slow: 2 },
      },
      {
        id: 'mage_meteor',
        name: 'Meteor',
        emoji: '‚òÑÔ∏è',
        description: 'Deal 350% damage to a single target.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 6,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 3.5 },
      },
      {
        id: 'mage_mana_shield',
        name: 'Mana Shield',
        emoji: 'üîÆ',
        description: 'Absorb the next 50 damage.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 8,
        targetType: TARGET_TYPE.SELF,
        effect: { type: EFFECT_TYPE.SHIELD, amount: 50 },
      },
      {
        id: 'mage_combustion',
        name: 'Combustion',
        emoji: 'üî•',
        description: 'Crits deal +50% damage.',
        type: SKILL_TYPE.PASSIVE,
        tier: 1,
        passive: { type: 'crit_damage_bonus', percent: 50 },
      },
      {
        id: 'mage_arcane_surge',
        name: 'Arcane Surge',
        emoji: '‚ö°',
        description: 'First skill each combat deals +100% damage.',
        type: SKILL_TYPE.PASSIVE,
        tier: 1,
        passive: { type: 'first_skill_bonus', damageBonus: 1.0 },
      },

      // Tier 2
      {
        id: 'mage_chain_lightning',
        name: 'Chain Lightning',
        emoji: '‚ö°',
        description: '120% damage bouncing to 3 enemies.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 5,
        targetType: TARGET_TYPE.ALL_ENEMIES,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 1.2, maxTargets: 3 },
      },
      {
        id: 'mage_pyroblast',
        name: 'Pyroblast',
        emoji: 'üåã',
        description: '500% damage, 8 turn cooldown.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 8,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 5.0 },
      },
      {
        id: 'mage_blink',
        name: 'Blink',
        emoji: 'üí®',
        description: 'Evade all attacks for 1 turn.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 6,
        targetType: TARGET_TYPE.SELF,
        effect: { type: EFFECT_TYPE.BUFF, evasion: 1 },
      },
      {
        id: 'mage_elemental_mastery',
        name: 'Elemental Mastery',
        emoji: 'üåü',
        description: '+20% damage.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'damage_bonus', percent: 20 },
      },
      {
        id: 'mage_ignite',
        name: 'Ignite',
        emoji: 'üî•',
        description: 'Attacks burn for 30% damage over 2 turns.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'attack_dot', percent: 30, duration: 2 },
      },

      // Tier 3 - Capstones
      {
        id: 'mage_inferno',
        name: 'Inferno',
        emoji: 'üåã',
        description: '400% damage to all enemies.',
        type: SKILL_TYPE.ACTIVE,
        tier: 3,
        cooldown: 10,
        targetType: TARGET_TYPE.ALL_ENEMIES,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 4.0 },
      },
      {
        id: 'mage_archmage',
        name: 'Archmage',
        emoji: 'üßô‚Äç‚ôÇÔ∏è',
        description: 'All cooldowns reduced by 2.',
        type: SKILL_TYPE.PASSIVE,
        tier: 3,
        passive: { type: 'cooldown_reduction', amount: 2 },
      },
      {
        id: 'mage_time_warp',
        name: 'Time Warp',
        emoji: '‚è∞',
        description: 'All allies act twice next turn. Once per room.',
        type: SKILL_TYPE.ACTIVE,
        tier: 3,
        cooldown: 999,
        targetType: TARGET_TYPE.ALL_ALLIES,
        effect: { type: EFFECT_TYPE.BUFF, extraTurn: true },
      },
    ],
  },

  rogue: {
    id: 'rogue',
    name: 'Rogue',
    emoji: 'üó°Ô∏è',
    skills: [
      // Tier 0 - Core
      {
        id: 'rogue_backstab',
        name: 'Backstab',
        emoji: 'üó°Ô∏è',
        description: '250% damage, always crits.',
        type: SKILL_TYPE.ACTIVE,
        tier: 0,
        starterSkill: true,
        cooldown: 4,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 2.5, alwaysCrit: true },
      },
      {
        id: 'rogue_quick_feet',
        name: 'Quick Feet',
        emoji: 'üëü',
        description: '+5 speed, +15% dodge chance.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'dodge_chance', percent: 15, stats: { speed: 5 } },
      },
      {
        id: 'rogue_precision',
        name: 'Precision',
        emoji: 'üéØ',
        description: '+10% crit chance.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'crit_bonus', percent: 10 },
      },
      {
        id: 'rogue_deadly_momentum',
        name: 'Deadly Momentum',
        emoji: 'üíÄ',
        description: '+10% damage after killing enemy (stacks).',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'on_kill_bonus', damagePercent: 10 },
      },

      // Tier 1
      {
        id: 'rogue_fan_of_knives',
        name: 'Fan of Knives',
        emoji: 'üî™',
        description: '100% damage to all enemies.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 4,
        targetType: TARGET_TYPE.ALL_ENEMIES,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 1.0 },
      },
      {
        id: 'rogue_smoke_bomb',
        name: 'Smoke Bomb',
        emoji: 'üí®',
        description: 'Evade all attacks for 2 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 7,
        targetType: TARGET_TYPE.SELF,
        effect: { type: EFFECT_TYPE.BUFF, evasion: 2 },
      },
      {
        id: 'rogue_cheap_shot',
        name: 'Cheap Shot',
        emoji: 'üëä',
        description: '80% damage + stun 2 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 6,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 0.8, stun: 2 },
      },
      {
        id: 'rogue_lethality',
        name: 'Lethality',
        emoji: '‚ò†Ô∏è',
        description: 'Crits deal +40% damage.',
        type: SKILL_TYPE.PASSIVE,
        tier: 1,
        passive: { type: 'crit_damage_bonus', percent: 40 },
      },
      {
        id: 'rogue_blade_flurry',
        name: 'Blade Flurry',
        emoji: 'üåÄ',
        description: 'Attacks hit 1 additional enemy for 50%.',
        type: SKILL_TYPE.PASSIVE,
        tier: 1,
        passive: { type: 'cleave', percent: 50 },
      },

      // Tier 2
      {
        id: 'rogue_assassinate',
        name: 'Assassinate',
        emoji: 'üíÄ',
        description: '400% damage to targets below 30% HP.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 6,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 4.0, executeThreshold: 0.3 },
      },
      {
        id: 'rogue_shadow_dance',
        name: 'Shadow Dance',
        emoji: 'üåë',
        description: '+50% damage and +10 speed for 3 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 8,
        targetType: TARGET_TYPE.SELF,
        effect: { type: EFFECT_TYPE.BUFF, damageBonus: 0.5, speedBonus: 10, duration: 3 },
      },
      {
        id: 'rogue_deadly_poison',
        name: 'Deadly Poison',
        emoji: '‚ò†Ô∏è',
        description: 'DoT: 60% damage over 3 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 5,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DOT, multiplier: 0.6, duration: 3 },
      },
      {
        id: 'rogue_vendetta',
        name: 'Vendetta',
        emoji: 'üéØ',
        description: '+25% damage to highest HP enemy.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'priority_target_bonus', damageBonus: 25 },
      },
      {
        id: 'rogue_elusiveness',
        name: 'Elusiveness',
        emoji: 'üë§',
        description: '20% dodge chance.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'dodge_chance', percent: 20 },
      },

      // Tier 3 - Capstones
      {
        id: 'rogue_death_blossom',
        name: 'Death Blossom',
        emoji: 'üå∏',
        description: '200% crit damage to all enemies.',
        type: SKILL_TYPE.ACTIVE,
        tier: 3,
        cooldown: 7,
        targetType: TARGET_TYPE.ALL_ENEMIES,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 2.0, alwaysCrit: true },
      },
      {
        id: 'rogue_kingslayer',
        name: 'Kingslayer',
        emoji: 'üëë',
        description: 'Enemies below 20% HP die instantly.',
        type: SKILL_TYPE.PASSIVE,
        tier: 3,
        passive: { type: 'execute', threshold: 0.2 },
      },
      {
        id: 'rogue_shadow_clone',
        name: 'Shadow Clone',
        emoji: 'üë•',
        description: 'Summon clone that copies attacks at 50% damage.',
        type: SKILL_TYPE.PASSIVE,
        tier: 3,
        passive: { type: 'shadow_clone', damagePercent: 50 },
      },
    ],
  },

  ranger: {
    id: 'ranger',
    name: 'Ranger',
    emoji: 'üèπ',
    skills: [
      // Tier 0 - Core
      {
        id: 'ranger_aimed_shot',
        name: 'Aimed Shot',
        emoji: 'üéØ',
        description: '200% damage.',
        type: SKILL_TYPE.ACTIVE,
        tier: 0,
        starterSkill: true,
        cooldown: 3,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 2.0 },
      },
      {
        id: 'ranger_eagle_eye',
        name: 'Eagle Eye',
        emoji: 'üëÅÔ∏è',
        description: '+4 attack.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'stat_bonus', stats: { attack: 4 } },
      },
      {
        id: 'ranger_swift_quiver',
        name: 'Swift Quiver',
        emoji: 'üèÉ',
        description: '+4 speed, +15% dodge chance.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'dodge_chance', percent: 15, stats: { speed: 4 } },
      },
      {
        id: 'ranger_steady_aim',
        name: 'Steady Aim',
        emoji: 'üéØ',
        description: '+15% crit chance, +15% damage to full HP targets.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'crit_bonus', percent: 15, openerDamageBonus: 15 },
      },

      // Tier 1
      {
        id: 'ranger_multishot',
        name: 'Multishot',
        emoji: 'üèπ',
        description: '120% damage to 3 enemies.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 5,
        targetType: TARGET_TYPE.ALL_ENEMIES,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 1.2, maxTargets: 3 },
      },
      {
        id: 'ranger_trap',
        name: 'Trap',
        emoji: 'ü™§',
        description: 'Stun target for 2 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 6,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DEBUFF, stun: 2 },
      },
      {
        id: 'ranger_disengage',
        name: 'Disengage',
        emoji: 'üí®',
        description: 'Evade 1 turn + buff speed 3 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 5,
        targetType: TARGET_TYPE.SELF,
        effect: { type: EFFECT_TYPE.BUFF, evasion: 1, speedBonus: 3, duration: 3 },
      },
      {
        id: 'ranger_hunters_mark',
        name: "Hunter's Mark",
        emoji: 'üî¥',
        description: 'Target takes +30% damage from all for 3 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 6,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DEBUFF, damageAmp: 0.3, duration: 3 },
      },
      {
        id: 'ranger_barrage',
        name: 'Barrage',
        emoji: 'üåßÔ∏è',
        description: '15% chance to attack twice.',
        type: SKILL_TYPE.PASSIVE,
        tier: 1,
        passive: { type: 'double_attack_chance', percent: 15 },
      },

      // Tier 2
      {
        id: 'ranger_piercing_arrow',
        name: 'Piercing Arrow',
        emoji: 'üìç',
        description: '180% damage, ignores 50% defense.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 5,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 1.8, armorPen: 0.5 },
      },
      {
        id: 'ranger_rapid_fire',
        name: 'Rapid Fire',
        emoji: '‚ö°',
        description: '60% damage √ó 4 hits.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 4,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 0.6, hits: 4 },
      },
      {
        id: 'ranger_volley',
        name: 'Volley',
        emoji: 'üåßÔ∏è',
        description: '150% damage to all enemies.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 7,
        targetType: TARGET_TYPE.ALL_ENEMIES,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 1.5 },
      },
      {
        id: 'ranger_sniper',
        name: 'Sniper',
        emoji: 'üî≠',
        description: '+25% damage from range 3+.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'range_bonus', minRange: 3, damageBonus: 25 },
      },
      {
        id: 'ranger_survival_instincts',
        name: 'Survival Instincts',
        emoji: 'ü¶ä',
        description: '+20% damage and evasion when below 40% HP.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'low_hp_bonus', threshold: 0.4, damageBonus: 0.2, evasionBonus: 20 },
      },

      // Tier 3 - Capstones
      {
        id: 'ranger_kill_shot',
        name: 'Kill Shot',
        emoji: 'üíÄ',
        description: '600% damage to targets below 25% HP.',
        type: SKILL_TYPE.ACTIVE,
        tier: 3,
        cooldown: 6,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 6.0, executeThreshold: 0.25 },
      },
      {
        id: 'ranger_arrow_storm',
        name: 'Arrow Storm',
        emoji: 'üå™Ô∏è',
        description: '200% damage to all + DoT 2 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 3,
        cooldown: 8,
        targetType: TARGET_TYPE.ALL_ENEMIES,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 2.0, dot: { percent: 0.3, duration: 2 } },
      },
      {
        id: 'ranger_beast_master',
        name: 'Beast Master',
        emoji: 'üê∫',
        description: 'Summon wolf companion (50% your stats).',
        type: SKILL_TYPE.PASSIVE,
        tier: 3,
        passive: { type: 'summon_pet', petType: 'wolf', statPercent: 50 },
      },
    ],
  },

  necromancer: {
    id: 'necromancer',
    name: 'Necromancer',
    emoji: 'üíÄ',
    skills: [
      // Tier 0 - Core
      {
        id: 'necromancer_drain_life',
        name: 'Drain Life',
        emoji: 'ü©∏',
        description: '150% damage, heal 50% of damage dealt.',
        type: SKILL_TYPE.ACTIVE,
        tier: 0,
        starterSkill: true,
        cooldown: 4,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 1.5, lifesteal: 0.5 },
      },
      {
        id: 'necromancer_dark_pact',
        name: 'Dark Pact',
        emoji: 'üñ§',
        description: '+12 attack, -10 max HP.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'stat_bonus', stats: { attack: 12, maxHp: -10 } },
      },
      {
        id: 'necromancer_bone_armor',
        name: 'Bone Armor',
        emoji: 'ü¶¥',
        description: '+8 defense.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'stat_bonus', stats: { defense: 8 } },
      },
      {
        id: 'necromancer_soul_siphon',
        name: 'Soul Siphon',
        emoji: 'üëª',
        description: 'Heal 5 HP on enemy kill.',
        type: SKILL_TYPE.PASSIVE,
        tier: 0,
        passive: { type: 'on_kill_heal', amount: 5 },
      },

      // Tier 1
      {
        id: 'necromancer_death_coil',
        name: 'Death Coil',
        emoji: 'üåÄ',
        description: '180% damage, CD resets on kill.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 5,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 1.8, resetOnKill: true },
      },
      {
        id: 'necromancer_curse_of_weakness',
        name: 'Curse of Weakness',
        emoji: 'üòµ',
        description: 'Target -30% attack for 3 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 5,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DEBUFF, attackReduction: 0.3, duration: 3 },
      },
      {
        id: 'necromancer_corpse_explosion',
        name: 'Corpse Explosion',
        emoji: 'üí•',
        description: 'Dead enemies explode for 100% damage to all.',
        type: SKILL_TYPE.ACTIVE,
        tier: 1,
        cooldown: 4,
        targetType: TARGET_TYPE.ALL_ENEMIES,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 1.0, requiresCorpse: true },
      },
      {
        id: 'necromancer_life_tap',
        name: 'Life Tap',
        emoji: '‚ù§Ô∏è‚Äçüî•',
        description: 'Spend 10% HP to deal +30% damage.',
        type: SKILL_TYPE.PASSIVE,
        tier: 1,
        passive: { type: 'hp_for_damage', hpCost: 10, damageBonus: 30 },
      },
      {
        id: 'necromancer_soul_harvest',
        name: 'Soul Harvest',
        emoji: 'üëª',
        description: '+15 max HP per enemy killed (dungeon).',
        type: SKILL_TYPE.PASSIVE,
        tier: 1,
        passive: { type: 'stacking_hp', hpPerKill: 15 },
      },

      // Tier 2
      {
        id: 'necromancer_plague',
        name: 'Plague',
        emoji: 'ü¶†',
        description: 'DoT: 50% damage to all over 4 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 7,
        targetType: TARGET_TYPE.ALL_ENEMIES,
        effect: { type: EFFECT_TYPE.DOT, multiplier: 0.5, duration: 4 },
      },
      {
        id: 'necromancer_dark_ritual',
        name: 'Dark Ritual',
        emoji: 'üïØÔ∏è',
        description: 'Sacrifice 30% HP, deal 300% damage.',
        type: SKILL_TYPE.ACTIVE,
        tier: 2,
        cooldown: 5,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.DAMAGE, multiplier: 3.0, selfDamagePercent: 0.3 },
      },
      {
        id: 'necromancer_undying',
        name: 'Undying',
        emoji: 'üíÄ',
        description: 'If would die above 50% HP, survive at 1 HP once.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'conditional_cheat_death', threshold: 0.5 },
      },
      {
        id: 'necromancer_necrosis',
        name: 'Necrosis',
        emoji: 'üß™',
        description: 'Your DoTs heal you for 25% of damage.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'dot_lifesteal', percent: 25 },
      },
      {
        id: 'necromancer_army_of_dead',
        name: 'Army of Dead',
        emoji: 'üíÄ',
        description: 'Slain enemies fight for you 1 turn.',
        type: SKILL_TYPE.PASSIVE,
        tier: 2,
        passive: { type: 'raise_dead', duration: 1 },
      },

      // Tier 3 - Capstones
      {
        id: 'necromancer_lich_form',
        name: 'Lich Form',
        emoji: 'üëë',
        description: '+50% damage, immune to DoT, -25% healing for 4 turns.',
        type: SKILL_TYPE.ACTIVE,
        tier: 3,
        cooldown: 10,
        targetType: TARGET_TYPE.SELF,
        effect: { type: EFFECT_TYPE.BUFF, damageBonus: 0.5, dotImmune: true, healingReduction: 0.25, duration: 4 },
      },
      {
        id: 'necromancer_soul_rend',
        name: 'Soul Rend',
        emoji: 'üëª',
        description: 'All attacks lifesteal 30%.',
        type: SKILL_TYPE.PASSIVE,
        tier: 3,
        passive: { type: 'lifesteal', percent: 30 },
      },
      {
        id: 'necromancer_raise_dead',
        name: 'Raise Dead',
        emoji: '‚ö∞Ô∏è',
        description: 'Revive strongest dead enemy to fight for you.',
        type: SKILL_TYPE.ACTIVE,
        tier: 3,
        cooldown: 8,
        targetType: TARGET_TYPE.SINGLE_ENEMY,
        effect: { type: EFFECT_TYPE.BUFF, raiseEnemy: true },
      },
    ],
  },
};

// Helper to get a skill by ID
export const getSkillById = (skillId) => {
  for (const classTree of Object.values(SKILL_TREES)) {
    const skill = classTree.skills.find(s => s.id === skillId);
    if (skill) return skill;
  }
  return null;
};

// Helper to get all skills for a class
export const getClassSkills = (classId) => {
  return SKILL_TREES[classId]?.skills || [];
};

// Helper to get starter skill for a class
export const getStarterSkill = (classId) => {
  const skills = getClassSkills(classId);
  return skills.find(s => s.starterSkill);
};

// Helper to count skills by tier for a class
export const countSkillsByTier = (classId, unlockedSkillIds, tier) => {
  const skills = getClassSkills(classId);
  return skills.filter(s => s.tier === tier && unlockedSkillIds.includes(s.id)).length;
};

// Tier prerequisites: how many skills from previous tier needed
export const TIER_REQUIREMENTS = {
  0: 0,  // No prereqs for tier 0
  1: 2,  // Need 2 tier 0 skills
  2: 3,  // Need 3 tier 1 skills
  3: 4,  // Need 4 tier 2 skills
};

// Helper to check if prerequisites are met (tier-based)
export const arePrerequisitesMet = (skill, unlockedSkillIds, classId) => {
  if (skill.tier === 0) return true;

  const prevTier = skill.tier - 1;
  const requiredCount = TIER_REQUIREMENTS[skill.tier];
  const unlockedInPrevTier = countSkillsByTier(classId, unlockedSkillIds, prevTier);

  return unlockedInPrevTier >= requiredCount;
};

// Calculate respec cost based on used skill points
export const calculateRespecCost = (usedSkillPoints) => {
  if (usedSkillPoints <= 0) return 0;
  return 50 * Math.pow(2, usedSkillPoints - 1);
};
